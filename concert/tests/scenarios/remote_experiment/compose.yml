services:
  uca_camera:
    container_name: uca_camera
    build: ../../../..
    restart: on-failure
    expose:
      - '8989'
      - '8993'
    command: ["ucad", "mock"]
    networks:
      concert_net:

  remote_walker:
    volumes:
      - /mnt:/mnt/ips_image_mnt
    container_name: remote_walker
    build: ../../../..
    restart: on-failure
    expose:
      - '7001'
      - '8993'
    command: ["concert", "tango", "walker", "--loglevel", "perfdebug", "--port", "7001"]
    depends_on:
      - uca_camera
    networks:
      concert_net:

  remote_experiment:
    volumes:
      - /mnt:/mnt/ips_image_mnt
      - .:/root/.local/share/concert/
    container_name: remote_experiment
    build: ../../../..
    restart: "no"
    environment:
      UCA_NET_HOST: "uca_camera"
      TARGET_LOCATION: "/mnt/ips_image_mnt"
    command: >
      bash -c "python3 /root/.local/share/concert/setup.py
      && concert start --non-interactive session_remote_exp 
      && python3 /root/.local/share/concert/assert.py
      && python3 /root/.local/share/concert/teardown.py"
    depends_on:
      - remote_walker
    networks:
      concert_net:

networks:
  concert_net: